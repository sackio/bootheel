<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <title>bootheel | Object View</title>
  <link rel="stylesheet" href="../node_modules/fatjs/node_modules/grunt-mocha/node_modules/mocha/mocha.css" />

  <link rel="stylesheet" href="../bower_components/bootstrap/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="../bower_components/fontawesome/css/font-awesome.min.css" />
  <link rel="stylesheet" href="../bower_components/bootstrap-multiselect/dist/css/bootstrap-multiselect.css" />
  <link rel="stylesheet" href="../bower_components/bootstrap-fileinput/css/fileinput.min.css" />
  <link rel="stylesheet" href="../bower_components/summernote/dist/summernote.css" />
  <link rel="stylesheet" href="../bower_components/summernote/dist/summernote-bs3.css" />

  <script src="/socket.io/socket.io.js"></script>
  <script src="../bower_components/underscore/underscore-min.js"></script>
  <script src="../bower_components/jsbelt/lib/belt.js"></script>
  <script src="../bower_components/moment/min/moment.min.js"></script>
  <script src="../bower_components/jquery/dist/jquery.min.js"></script>
  <script src="../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
  <script src="../bower_components/bootstrap-multiselect/dist/js/bootstrap-multiselect.js"></script>
  <script src="../bower_components/bootstrap-fileinput/js/fileinput.min.js"></script>
  <script src="../bower_components/bootbox/bootbox.js"></script>
  <script src="../bower_components/backbone/backbone.js"></script>
  <script src="../bower_components/summernote/dist/summernote.min.js"></script>
  <script src="../bower_components/ace/build/src/ace.js"></script>
  <script src="../bower_components/ace/build/src/theme-eclipse.js" type="text/javascript" charset="utf-8"></script>
  <script src="../bower_components/ace/build/src/mode-javascript.js" type="text/javascript" charset="utf-8"></script>

  <style>
    form {
      padding: 40px;
    }

    .row.header {
      margin-top: 30px;
      padding-top: 20px;
      margin-bottom: 15px;
      border-top: 2px #ccc solid;
    }
    legend {
      border: none;
    }

    textarea {
      resize: none;
    }
    
    * {
      white-space: -moz-pre-wrap !important;  /* Mozilla, since 1999 */
      white-space: -pre-wrap;      /* Opera 4-6 */
      white-space: -o-pre-wrap;    /* Opera 7 */
      white-space: pre-wrap;       /* css-3 */
      word-wrap: break-word;       /* Internet Explorer 5.5+ */
      white-space: -webkit-pre-wrap; /* Newer versions of Chrome/Safari*/
      word-break: break-all;
      white-space: normal;
    }

    [data-control="ace"] .editor {
        position: relative;
        width: 100%;
        height: 400px;
    }
  </style>

</head>
<body>
  <div id="fixture">
    <form class="form-horizontal">

    </form>
  </div>
  <script src="../lib/bootheel.js" data-cover></script>
  <script>
    var gb = {};
    gb.name = 'summernote';
    gb.view = _$.view({
      'control': 'summernote'
    , 'render': {
        'transformer': function(){ this.$('.editor').summernote(this.settings); return this; }
      }
    , 'set': {
        'method': 'code'
      , 'selector': '.editor'
      , 'transformer': function(val){ return Belt.isNull(val) ? '' : Belt.cast(val, 'string'); }
      }
    , 'get': {
        'method': 'code'
      , 'selector': '.editor'
      }
    , 'settings': {
        'height': 300
      }
    , 'layout': ['label', 'status', 'editor']
    , 'views': {
        'label': _$.label({'attr': {'for': gb.name}}, String(gb.name))
      , 'status': _$.viewsArray({
                    'class': ['status']
                  , 'default_view': 'alertControl'
                  , 'child': {
                      'type': 'danger'
                    , 'removable': false
                    }
                  })
      , 'editor': _$.div({'class': 'editor', 'attr': {'name': gb.name}})
      }
    , 'view': {
        'setStatus': function(err, options){
            var _o = options || {}
              , _e = Belt.toArray(err || [])
              , rt = {'ostatus': this.getStatus()};

            _o = _.defaults(_o, {
              'state': _.any(_e) ? 'error' : undefined
            , 'reset': 'true'
            });

            var stat = this.getView('status', {'subpaths': ''});

            //hack
            if (!stat) stat = Belt.chain(this, ['getControl'], ['getView', 'status', {'subpaths': ''}]);

            if (!stat) return;
            if (_o.reset) _.each(Belt.call(stat, 'getViews') || [], function(v){
              return stat.pop();
            });

            _.each(_e, function(r){
              return stat.push(r, {'type': _o.state, 'removable': _o.removable});
            });

            rt.status = {'state': _o.state, 'status': _o.reset ? _e : rt.ostatus.status.concat(_e)};

            this.trigger('setStatus', rt);
            return rt;
          }
        , 'getStatus': function(){
            var stat = {
              'status': _.pluck(Belt.chain(this, ['getView', 'status', {'subpaths': ''}], 'get') || [], 'html')
            }
            return stat;
          }
        }
    });

    gb.cm = 'code';
    gb.view2 = _$.view({
      'control': 'ace'
    , 'name': gb.cm
    , 'render': {
        'transformer': function(){
           this.$editor = ace.edit(this.$('.editor')[0], this.settings);
           this.$editor.setTheme('ace/theme/eclipse');
           this.$editor.getSession().setMode('ace/mode/javascript');
           return this;
         }
      }
    , 'set': {
        'method': '$editor.setValue'
      , 'transformer': function(val){ return Belt.isNull(val) ? '' : Belt.cast(val, 'string'); }
      }
    , 'get': {
        'method': '$editor.getValue'
      }
    , 'settings': {
        'mode': 'javascript'
      , 'theme': 'elegant'
      , 'lineNumbers': true
      }
    , 'layout': ['label', 'status', 'editor']
    , 'views': {
        'label': _$.label({'attr': {'for': gb.cm}}, String(gb.cm))
      , 'status': _$.viewsArray({
                    'class': ['status']
                  , 'default_view': 'alertControl'
                  , 'child': {
                      'type': 'danger'
                    , 'removable': false
                    }
                  })
      , 'editor': _$.div({'class': 'editor', 'attr': {'name': gb.cm}})
      }
    , 'view': {
        'setStatus': function(err, options){
            var _o = options || {}
              , _e = Belt.toArray(err || [])
              , rt = {'ostatus': this.getStatus()};

            _o = _.defaults(_o, {
              'state': _.any(_e) ? 'error' : undefined
            , 'reset': 'true'
            });

            var stat = this.getView('status', {'subpaths': ''});

            //hack
            if (!stat) stat = Belt.chain(this, ['getControl'], ['getView', 'status', {'subpaths': ''}]);

            if (!stat) return;
            if (_o.reset) _.each(Belt.call(stat, 'getViews') || [], function(v){
              return stat.pop();
            });

            _.each(_e, function(r){
              return stat.push(r, {'type': _o.state, 'removable': _o.removable});
            });

            rt.status = {'state': _o.state, 'status': _o.reset ? _e : rt.ostatus.status.concat(_e)};

            this.trigger('setStatus', rt);
            return rt;
          }
        , 'getStatus': function(){
            var stat = {
              'status': _.pluck(Belt.chain(this, ['getView', 'status', {'subpaths': ''}], 'get') || [], 'html')
            }
            return stat;
          }
        }
    });

    $('#fixture form').append(gb.view.$el);
    $('#fixture form').append('<hr>');
    $('#fixture form').append(gb.view2.$el);

    gb.view.render();
    gb.view2.render();

  </script>
</body>
</html>
